# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемых в приложении

Товар

```
export interface IProductItem {
    id: string;
    description : string;
    image : string;
    title : string;
    category: string;
    price : number | null;
}
```

Пользователь 

```
export interface IUser {
    payment : TPaymentMethod;
    email : string;
    phone : string;
    address : string;
}
```

Корзина

```
export interface ICart {
    find(arg0: (item: { id: IProductItem; }) => boolean): unknown;
    items : IProductItem[];
    total : number;
}
```

Оформление заказа

```
export interface TOrder {
    id: string;
    total: number;
}
```

Список товаров 

```
export interface IProductList {
    total: number;
    items: IProductItem[]
}
```
Данные списка товаров, используемые при формировании корзины

```
export type TProductList = IProductList;
```

Данные пользователя, в форме способа оплаты 

```
export type TPaymentMethod = 'cash' | 'card';
```

Основные данные пользователя 

```
export type TUserInfo = Pick<IUser, 'email' | 'phone'>;
```

## Архитектура приложения 

Код разделен на слои согласно парадигме MVP:
- слой представления, отвечает  за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

## Описание классов проекта:

#### Класс Арі
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональний объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах сидпоинт и возвращает промис с объектом, которим ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на едпоинт переданный как параметр при визове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Методы | Свойства класса:
- on — устанавливает обработчик на определённое событие;
- off — позволяет снять установленный обработчик события;
- emit — инициирует событие с переданными данными;
- onAll — предоставляет возможность подписаться на все события;
- offAll — удаляет все зарегистрированные обработчики для всех событий;
- trigger — создаёт коллбэк-триггер, генерирующий указанное событие при вызове.

#### Класс ProductItem
Класс отвечает за хранение и логику работы с каталогом товаров.\
В полях класса хронятся следующие данные: 
- _items: IProductItem[] - массив объектов товаров 
- _preview: string | null - id товара, выбранного для простомтра в модальном окне 

Так же класс представляет собой набор методов для взаимодействия с данными. 
- addProduct: (product: IProductItem) => void - заполняет каталог 
- getProduct: (productId: string) => IProductItem | null - получает каталог

#### Класс User
Класс отвечает за логику работы с данными пользователя.\
Методы для взаимодействия: 
- setPaymentMethod: (method: TPaymentMethod) => void - выбор способа оплаты и указание адреса доставки
- setUserInfo: (info: TUserInfo) => void - указание почты и номера телефона
- clearInfo: () => void - метод для очистки данных

#### Класс Component 
Класс для работы с интерфейсом.\
Методы | Свойства класса:
- constructor — принимает HTML-элемент;
- toggleClass — переключает класс элемента;
- setText — устанавливает текстового содержимого элемента;
- setDisabled — устанавливает состояния блокировки элемента;
- setHidden — скрывает элемент;
- setVisible — отображает элемент;
- setImage — устанавливает изображения с альтернативным текстом;
- render — рендерит компонент с передачей данных, если они есть.

#### Класс Form 
Абстактный класс, наследующий `Component`. Класс ввода данных и отображения ошибок в форме.\
Методы | Свойства класса:
- onInputChange — обрабатывает изменение значения в поле формы;
- valid — устанавливает состояние валидности формы;
- errors — выводит сообщение об ошибке;
- render — рендерит форму с передачей данных о состоянии и ошибках, если они есть.

#### Класс Page
Класс глвной страницы приложения. 
Методы | Свойства класса:
- constructor — принимает HTML-элемент и объект событий для обработки действий пользователя;
- _basket - корзина;
- _counter - счетчик товаров в корзине;
- _products - каталог товаров на странице;
- _wrapper - обертка страницы;
- set -устонавливает значение у страницы;
- get - получает значение у страницы.

#### Класс Modal
Реализует модальное окно, которое является контейнером для других представлений. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.
Методы | Свойства класса:
- constructor — принимает HTML-элемент и объект событий для обработки действий пользователя;
- open — открывает модальное окно;
- close — закрывает модальное окно;
- render — рендерит модальное окно с передачей данных о контенте.

#### Класс Card
Класс карточки товара. Предназначен для реализации модального карточки товара.
Методы | Свойства класса:
- id - уникальный идентификатор товара.
- title - название товара (например, "+1 час в сутках").
- category - краткое описание или категория товара (например, "софт-скилл").
- description - более подробное описание товара (например, "Если планируете решать задачи в тренажёре, берите два.").
- price - стоимость товара в синнапсах (например, 750).
- image - URL изображения товара.
- constructor - конструктор, инициализирующий объект товара с указанными полями.
- addProduct: (product: IProductItem) => void - добавление товара в корзину 
- getProducts: () => IProductItem[] - получить список товаров 
- removeProduct: (productId: string) => void - удалить товар из корзины 
- clearBasket: () => void - очищать корзину товаров 

#### Класс Cart
Предназначен для отображение списка товаров и их стоимости в корзине.
Методы | Свойства класса:
constructor — принимает HTML-элемент и и объект событий для обработки действий пользователя;
items — отображает товаров в корзине;
total — выводит общую стоимость товаров в корзине.

#### Класс UserInfo
Предназначен для установки данных пользователя 
Методы | Свойства класса:
- constructor — принимает HTML-элемент и объект событий для обработки действий пользователя;
- email — устанавливает электронную почту;
- phone — устанавливает номер телефона;

#### Класс OrderInfo
Предназначен для установки данных заказа
Методы | Свойства класса:
- constructor — принимает HTML-элемент и объект событий для обработки действий пользователя;
- address — устанавливает адрес доставки;
- paymentmethod — устанавливает выбранный метод оплаты.

#### Класс OrderSuccess
Предназначен для сообщения об оформлении заказа.
Методы | Свойства класса:
- constructor — принимает HTML-элемент и объект действий для обработки событий клика;
- total — устанавливает стоимость заказа.

#### Класс AppData
Отвечает за хранение данных и логику работы с ними.

Поля:
items - массив товаров
preview - товар, который открыт в данный момент
cart - объект корзины (товары в ней и их сумму)
order - данные заказа
formErrors - данные валидации формы
events - инстанс брокера событий (добавляется через конструктор)

Методы:
setProducts - меняет массив товаров на переданный и эмитит событие items:change
setPreview - меняет превью на переданный товар и эмитит событие preview:change
isInCart - проверяет наличие переданного товара в корзине
addToCart - добавляет переданный товар в корзину и эмитит событие basket:change
removeFromCart - убирает переданный товар из корзины и эмитит событие basket:change
clearCart - очищает корзину и эмитит событие basket:change
setPaymentMethod - меняет способ оплаты на переданный
setOrderField - меняет содержимое переданного поля на полученное значение
setUserField - меняет содержимое переданного поля на полученное значение
validateOrder - проверяет корректность заполнения формы
clearOrder - очищает объект заказа
getOrder - передает данные о заказе

#### Класс AppApi
Дополняет базовый класс Api методами работы с конкретным сервером проекта.

constructor(cdn: string, baseUrl: string, options?: RequestInit) - принимает url сервера с контентом, url сервера, по которому будут совершаться запросы, и общие опции для этих запросов.

Методы:
getProductList - возвращает массив продуктов с сервера;
getProduct - возвращает продукт с сервера по переданному id;
createOrder - отправляет переданный заказ на сервер и возвращает результат.

## Взаимодействие компонентов 
Код, описывающий взаимодействие представления и данных хранится в `index.ts`\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанних в `index.ts`\
B `index.ts` сначала создаются экземпляри всех необходимых классов, а затем настраивается
обработка событий.

##### Список событий, которые могут генерироваться в системе:
*События изменения данных*
- `items:change` - изменение списка товаров;
- `formErrors:change` - событие для определения статуса валидности форм оформления заказа;
- `preview:change` - изменение открываемого в модальном окне товара;
- `cart:change` - изменение списка товаров корзины.

*События, возникающие при взаимодействии с интерфейсом*
- `odal:open` - открытие любого модального окна
- `modal:close` - закрытие любого модального окна
- `basket:open` - открытие модального окна корзины
- `card:select` - выбор карточки
- `order:open` - открытие окна оформления заказа
- `${form}:submit` - отправка формы с кастомным названием
- `${form}.${field}:change` - изменение поля с кастомным названием в форме с кастомным названием