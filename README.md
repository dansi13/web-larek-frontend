# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемых в приложении

Товар

```
export interface IProductItem {
    id: string;
    description : string;
    image : string;
    title : string;
    category: string;
    price : number;
}
```

Пользователь 

```
export interface IUser {
    payment : string;
    email : string;
    phone : string;
    address : string;
    total: number;
    items : IProductItem[];
}
```

Список товаров 

```
export interface IProductList {
    total: number;
    items: IProductItem[]
}
```
Данные списка товаров, используемые при формировании корзины

```
export type TProductList = IProductList;
```

Данные пользователя, в форме способа оплаты 

```
export type TPaymentMethod = Pick<IUser, 'payment' | 'address'>;
```

Основные данные пользователя 

```
export type TUserInfo = Pick<IUser, 'email' | 'phone'>;
```

Данные, используемые при завершении заказа

```
export type TOrder = Pick<IUser, 'total'>;
```


## Архитектура приложения 

Код разделен на слои согласно парадигме MVP:
- слой представления, отвечает  за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

## Базовый код

#### Класс Арі
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональний объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах сидпоинт и возвращает промис с объектом, которим ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на едпоинт переданный как параметр при визове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных 

#### Класс IProductItemData
Класс отвечает за хранение и логику работы с каталогом товаров.\
В полях класса хронятся следующие данные: 
- _items: IProductItem[] - массив объектов товаров 
- _preview: string | null - id товара, выбранного для простомтра в модальном окне 

Так же класс представляет собой набор методов для взаимодействия с данными. 
- addProduct: (product: IProductItem) => void - заполняет каталог 
- getProduct: (productId: string) => IProductItem | null - получает каталог 


#### Класс IUserData
Класс отвечает за логику работы с данными пользователя.\
Методы для взаимодействия: 
- setPaymentMethod: (method: TPaymentMethod) => void - выбор способа оплаты и указание адреса доставки
- setUserInfo: (info: TUserInfo) => void - указание почты и номера телефона
- clearInfo: () => void - метод для очистки данных


#### Класс IBasketData
Класс отвечает за хранение и логику работы с корзиной товаров.\
Методы для взаимодействия: 
- addProduct: (product: IProductItem) => void - добавление товара в корзину 
- getProducts: () => IProductItem[] - получить список товаров 
- removeProduct: (productId: string) => void - удалить товар из корзины 
- clearBasket: () => void - очищать корзину товаров 

### Классы представления 
Все классы представления отвеччают за отображение внутри контейнера (DOM-элекмент) передаваемых в них данных.

#### Класс Page
Класс глвной страницы приложения. 

Методы | Свойства класса:
- constructor — принимает HTML-элемент и объект событий для обработки действий пользователя;
- _basket - корзина;
- _counter - счетчик товаров в корзине;
- _products - каталог товаров на странице;
- _wrapper - обертка страницы;
- set -устонавливает значение у страницы;
- get - получает значение у страницы.

#### Класс Modal
Реализует модальное окно, которое является контейнером для других представлений. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.

Методы | Свойства класса:
- constructor — принимает HTML-элемент и объект событий для обработки действий пользователя;
- open — открывает модальное окно;
- close — закрывает модальное окно;
- render — рендерит модальное окно с передачей данных о контенте.

#### Класс Card
Класс карточки товара. Предназначен для реализации модального карточки товара.

Методы | Свойства класса:
- id - уникальный идентификатор товара.
- title - название товара (например, "+1 час в сутках").
- category - краткое описание или категория товара (например, "софт-скилл").
- description - более подробное описание товара (например, "Если планируете решать задачи в тренажёре, берите два.").
- price - стоимость товара в синнапсах (например, 750).
- image - URL изображения товара.
- constructor - конструктор, инициализирующий объект товара с указанными полями.

#### Класс Basket
Предназначен для отображение списка товаров и их стоимости в корзине.

Методы | Свойства класса:
constructor — принимает HTML-элемент и и объект событий для обработки действий пользователя;
items — отображает товаров в корзине;
total — выводит общую стоимость товаров в корзине.

#### Класс Contacts
Предназначен для установки данных пользователя 

Методы | Свойства класса:
- constructor — принимает HTML-элемент и объект событий для обработки действий пользователя;
- address — устанавливает адрес доставки;
- email — устанавливает электронную почту;
- phone — устанавливает номер телефона;
- paymentmethod — устанавливает выбранный метод оплаты.

#### Класс Order
Предназначен для сообщения об оформлении заказа.

Методы | Свойства класса:
- constructor — принимает HTML-элемент и объект действий для обработки событий клика;
- total — устанавливает стоимость заказа.

### Слой коммуникации 

#### Класс AppApi
Принемает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом.

## Взаимодействие компонентов 
Код, описывающий взаимодействие представления и данных хранится в `index.ts`\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанних в `index.ts`\
B `index.ts` сначала создаются экземпляри всех необходимых классов, а затем настраивается
обработка событий.

##### Список событий, которые могут генерироваться в системе:

*События изменения данных*
- `cards:changed` - изменение списка товаров;
- `contactsFormErrors:change` - событие для определения статуса валидности форм оформления заказа.

*События, возникающие при взаимодействии с интерфейсом*
- `card:select` - выбор карточки для отображения в модальном окне;
- `card:toBasket` - добавляет выбранный элемент в корзину;
- `basket:open` - открывает модальное окно с корзиной товаров;
- `basket:delete` - удаляет товар из корзины;
- `basket:order` - инициализируется при нажатии на кнопку "Оформить" в корзине;
- `order:submit` - инициализируется при нажатии на кнопку "Далее" при выборе способа оплаты;
- `contacts:submit` - инициализируется при нажатии на кнопку "Оплатить" при указании контактов;
- `order:seccess` - инициализируется при нажатии на кнопку  при успешном оформлении заказа;
- `modal:close` - инициализируется при закрытии модального окна.